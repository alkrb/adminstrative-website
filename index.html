<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المدرسة النموذجية - نظام إدارة الدروس والامتحانات</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&family=Aref+Ruqaa:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1a56db;
            --secondary-color: #0e4aa9;
            --accent-color: #f59e0b;
            --light-color: #f8fafc;
            --dark-color: #1e293b;
            --gray-light: #e2e8f0;
            --gray-medium: #64748b;
            --gray-dark: #334155;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --border-radius: 12px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', 'Arial', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e7ec 100%);
            color: var(--dark-color);
            min-height: 100vh;
            direction: rtl;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            margin-bottom: 40px;
            text-align: center;
        }

        .header-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .header-logo {
            width: 350px;
            height: 250px;
            object-fit: contain;
            border-radius: 50%;
            transition: var(--transition);
        }

        .header-logo:hover {
            transform: scale(1.05);
        }

        .school-name-image {
            width: 100%;
            max-width: 600px;
            height: auto;
            margin: 10px 0;
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.1));
        }

        .login-section {
            background: #FFFFFF;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            max-width: 500px;
            margin: 0 auto 40px;
            text-align: center;
        }

        .section-title {
            text-align: center;
            margin-bottom: 30px;
        }

        .section-title h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .section-title p {
            color: var(--gray-medium);
            font-size: 1.1rem;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 400px;
            margin: 0 auto;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            text-align: right;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }

        .form-input, .form-select {
            padding: 12px 15px;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            background: white;
            transition: var(--transition);
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 86, 219, 0.1);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius);
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
        }

        .btn-secondary {
            background: var(--gray-light);
            color: var(--dark-color);
        }

        .btn-secondary:hover {
            background: var(--gray-medium);
            color: white;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .action-card {
            background: #FFFFFF;
            border-radius: var(--border-radius);
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--box-shadow);
            border: 1px solid var(--gray-light);
            position: relative;
            overflow: hidden;
        }

        .action-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }

        .action-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .action-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .action-card h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .action-card p {
            font-size: 1rem;
            color: var(--gray-medium);
        }

        .data-view {
            background: #FFFFFF;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            max-width: 1000px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease;
        }

        .data-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--gray-light);
            padding-bottom: 20px;
        }

        .back-btn {
            background: var(--primary-color);
            color: #FFFFFF;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Tajawal', sans-serif;
            margin-left: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .back-btn:hover {
            background: var(--secondary-color);
            transform: translateX(-5px);
        }

        .data-list {
            list-style: none;
        }

        .data-item {
            background: #FFFFFF;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-right: 4px solid var(--primary-color);
            transition: var(--transition);
            animation: slideIn 0.5s ease;
            border: 1px solid var(--gray-light);
            position: relative;
            overflow: hidden;
        }

        .data-item::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-color);
        }

        .data-item:hover {
            transform: translateX(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .data-item h3 {
            color: var(--dark-color);
            margin-bottom: 12px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .data-item h3::before {
            content: '•';
            color: var(--primary-color);
            font-size: 1.5rem;
        }

        .data-item p {
            color: var(--dark-color);
            line-height: 1.7;
            margin-bottom: 8px;
        }

        .admin-panel {
            background: #FFFFFF;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            max-width: 1000px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease;
        }

        .admin-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--gray-light);
            padding-bottom: 20px;
        }

        .admin-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .admin-section {
            margin-bottom: 40px;
        }

        .admin-section h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--dark-color);
            border-right: 4px solid var(--primary-color);
            padding-right: 15px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid var(--gray-light);
        }

        .data-table th {
            background-color: var(--light-color);
            font-weight: 600;
            color: var(--dark-color);
        }

        .data-table tr:hover {
            background-color: rgba(26, 86, 219, 0.05);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: #FFFFFF;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #FFFFFF;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading p {
            font-size: 1.2rem;
        }

        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }

        .day-group {
            margin-bottom: 30px;
        }

        .day-group h3 {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: var(--primary-color);
            border-right: 4px solid var(--accent-color);
            padding-right: 10px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            header {
                margin-bottom: 30px;
            }
            
            .school-name-image {
                max-width: 400px;
            }
            
            .header-logo {
                width: 120px;
                height: 120px;
            }
            
            .section-title h2 {
                font-size: 1.7rem;
            }
            
            .login-section, .admin-panel {
                padding: 20px;
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
            }
            
            .data-view {
                padding: 20px;
                margin: 10px;
            }
            
            .data-header, .admin-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .back-btn {
                margin-left: 0;
                margin-bottom: 10px;
                align-self: flex-start;
            }
            
            .data-header h2 {
                font-size: 1.5rem;
            }
            
            .data-item {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .data-item h3 {
                font-size: 1.2rem;
            }
            
            .admin-actions {
                flex-direction: column;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .data-table {
                font-size: 0.9rem;
            }
            
            .data-table th, .data-table td {
                padding: 8px 10px;
            }
        }

        @media (max-width: 480px) {
            .school-name-image {
                max-width: 300px;
            }
            
            .header-text p {
                font-size: 1rem;
            }
            
            .header-logo {
                width: 100px;
                height: 100px;
            }
            
            .data-view, .admin-panel {
                padding: 15px;
                margin: 5px;
            }
            
            .data-item {
                padding: 12px;
            }
            
            .data-item h3 {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <img src="logo.png" alt="شعار المدرسة النموذجية" class="header-logo">
            </div>
        </header>

        <!-- قسم تسجيل الدخول -->
        <section id="login-section" class="login-section">
            <div class="section-title">
                <h2>تسجيل الدخول</h2>
                <p>اختر نوع الحساب وأدخل بيانات الدخول</p>
            </div>
            <form id="login-form" class="login-form">
                <div class="form-group">
                    <label for="user-type">نوع المستخدم:</label>
                    <select id="user-type" class="form-select" required>
                        <option value="">-- اختر نوع المستخدم --</option>
                        <option value="student">طالب</option>
                        <option value="admin">إدارة</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="username">اسم المستخدم:</label>
                    <input type="text" id="username" class="form-input" placeholder="أدخل اسم المستخدم" required>
                </div>
                <div class="form-group">
                    <label for="password">كلمة المرور:</label>
                    <input type="password" id="password" class="form-input" placeholder="أدخل كلمة المرور" required>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>تسجيل الدخول</span>
                </button>
            </form>
        </section>

        <!-- واجهة الطالب -->
        <section id="student-dashboard" class="hidden">
            <div class="section-title">
                <h2 id="student-welcome">مرحباً، الطالب</h2>
                <div class="user-info">
                    <span id="student-info"></span>
                    <button id="student-logout" class="btn btn-secondary">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>تسجيل الخروج</span>
                    </button>
                </div>
            </div>
            
            <div class="actions-grid">
                <div class="action-card" id="exams-btn">
                    <div class="action-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <h3>جدول الامتحانات</h3>
                    <p>عرض الامتحانات والاختبارات</p>
                </div>
                <div class="action-card" id="lessons-btn">
                    <div class="action-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <h3>جدول الدروس</h3>
                    <p>عرض جدول الدروس الأسبوعي</p>
                </div>
            </div>

            <!-- صفحة جدول الامتحانات -->
            <div id="exams-section" class="data-view hidden">
                <div class="data-header">
                    <button id="back-from-exams" class="back-btn">
                        <i class="fas fa-arrow-right"></i>
                        <span>العودة</span>
                    </button>
                    <div class="day-info">
                        <h2 id="exams-title">جدول الامتحانات</h2>
                    </div>
                </div>
                <div class="exams-container">
                    <ul id="exams-list" class="data-list">
                        <!-- سيتم ملء الامتحانات بواسطة JavaScript -->
                    </ul>
                </div>
            </div>

            <!-- صفحة جدول الدروس -->
            <div id="lessons-section" class="data-view hidden">
                <div class="data-header">
                    <button id="back-from-lessons" class="back-btn">
                        <i class="fas fa-arrow-right"></i>
                        <span>العودة</span>
                    </button>
                    <div class="day-info">
                        <h2 id="lessons-title">جدول الدروس</h2>
                    </div>
                </div>
                <div class="lessons-container">
                    <div id="lessons-list">
                        <!-- سيتم ملء الدروس بواسطة JavaScript -->
                    </div>
                </div>
            </div>
        </section>

        <!-- واجهة الإدارة -->
        <section id="admin-dashboard" class="hidden">
            <div class="section-title">
                <h2>لوحة التحكم - الإدارة</h2>
                <div class="user-info">
                    <span>مدير النظام</span>
                    <button id="admin-logout" class="btn btn-secondary">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>تسجيل الخروج</span>
                    </button>
                </div>
            </div>
            
            <div class="admin-panel">
                <div class="admin-actions">
                    <button id="manage-lessons" class="btn btn-primary">
                        <i class="fas fa-book"></i>
                        <span>إدارة جدول الدروس</span>
                    </button>
                    <button id="manage-exams" class="btn btn-primary">
                        <i class="fas fa-file-alt"></i>
                        <span>إدارة جدول الامتحانات</span>
                    </button>
                </div>

                <!-- قسم إدارة الدروس -->
                <div id="lessons-management" class="admin-section">
                    <h3>إدارة جدول الدروس</h3>
                    <form id="add-lesson-form" class="login-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="lesson-grade">الصف:</label>
                                <select id="lesson-grade" class="form-select" required>
                                    <option value="">-- اختر الصف --</option>
                                    <option value="grade4">الصف الرابع علمي</option>
                                    <option value="grade5">الصف الخامس علمي</option>
                                    <option value="grade6">الصف السادس علمي</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="lesson-class">الشعبة:</label>
                                <select id="lesson-class" class="form-select" required>
                                    <option value="">-- اختر الشعبة --</option>
                                    <option value="أ">شعبة أ</option>
                                    <option value="ب">شعبة ب</option>
                                    <option value="ج">شعبة ج</option>
                                    <option value="د">شعبة د</option>
                                    <option value="هـ">شعبة هـ</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="lesson-day">اليوم:</label>
                                <select id="lesson-day" class="form-select" required>
                                    <option value="">-- اختر اليوم --</option>
                                    <option value="sunday">الأحد</option>
                                    <option value="monday">الاثنين</option>
                                    <option value="tuesday">الثلاثاء</option>
                                    <option value="wednesday">الأربعاء</option>
                                    <option value="thursday">الخميس</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="lesson-time">الوقت:</label>
                                <input type="text" id="lesson-time" class="form-input" placeholder="مثال: 8:00 - 9:00" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="lesson-subject">المادة:</label>
                                <input type="text" id="lesson-subject" class="form-input" placeholder="أدخل اسم المادة" required>
                            </div>
                            <div class="form-group">
                                <label for="lesson-teacher">المعلم:</label>
                                <input type="text" id="lesson-teacher" class="form-input" placeholder="أدخل اسم المعلم" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-plus"></i>
                            <span>إضافة الدرس</span>
                        </button>
                    </form>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>الصف</th>
                                <th>الشعبة</th>
                                <th>اليوم</th>
                                <th>الوقت</th>
                                <th>المادة</th>
                                <th>المعلم</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="lessons-table-body">
                            <!-- سيتم ملء جدول الدروس بواسطة JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- قسم إدارة الامتحانات -->
                <div id="exams-management" class="admin-section hidden">
                    <h3>إدارة جدول الامتحانات</h3>
                    <form id="add-exam-form" class="login-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="exam-grade">الصف:</label>
                                <select id="exam-grade" class="form-select" required>
                                    <option value="">-- اختر الصف --</option>
                                    <option value="grade4">الصف الرابع علمي</option>
                                    <option value="grade5">الصف الخامس علمي</option>
                                    <option value="grade6">الصف السادس علمي</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="exam-class">الشعبة:</label>
                                <select id="exam-class" class="form-select" required>
                                    <option value="">-- اختر الشعبة --</option>
                                    <option value="أ">شعبة أ</option>
                                    <option value="ب">شعبة ب</option>
                                    <option value="ج">شعبة ج</option>
                                    <option value="د">شعبة د</option>
                                    <option value="هـ">شعبة هـ</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="exam-date">التاريخ:</label>
                                <input type="date" id="exam-date" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="exam-time">الوقت:</label>
                                <input type="text" id="exam-time" class="form-input" placeholder="مثال: 9:00 - 10:30" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="exam-subject">المادة:</label>
                                <input type="text" id="exam-subject" class="form-input" placeholder="أدخل اسم المادة" required>
                            </div>
                            <div class="form-group">
                                <label for="exam-duration">المدة:</label>
                                <input type="text" id="exam-duration" class="form-input" placeholder="مثال: ساعة ونصف" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-plus"></i>
                            <span>إضافة الامتحان</span>
                        </button>
                    </form>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>الصف</th>
                                <th>الشعبة</th>
                                <th>التاريخ</th>
                                <th>الوقت</th>
                                <th>المادة</th>
                                <th>المدة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="exams-table-body">
                            <!-- سيتم ملء جدول الامتحانات بواسطة JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- مؤشر التحميل -->
        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p>جاري تحميل البيانات...</p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    
    <script>
        // إعدادات Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCctRA8GcMlYNvk6nBE1YXeYruQwkawcHA",
            authDomain: "daily-tasks-a69ab.firebaseapp.com",
            databaseURL: "https://daily-tasks-a69ab-default-rtdb.firebaseio.com",
            projectId: "daily-tasks-a69ab",
            storageBucket: "daily-tasks-a69ab.firebasestorage.app",
            messagingSenderId: "799210899623",
            appId: "1:799210899623:web:2cc09163c30bdd1db4b382",
            measurementId: "G-0B95KRGK2S"
        };

        // تهيئة Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // بيانات المستخدمين (في بيئة حقيقية، يجب تخزينها بشكل آمن)
        const users = {
            student: {
                username: "student1",
                password: "2009",
                grade: "grade5",
                class: "هـ"
            },
                        student: {
                username: "student2",
                password: "2009",
                grade: "grade5",
                class: "أ"
            },
            admin: {
                username: "yr9_v",
                password: "2009"
            }
        };

        // عناصر DOM
        const loginSection = document.getElementById('login-section');
        const studentDashboard = document.getElementById('student-dashboard');
        const adminDashboard = document.getElementById('admin-dashboard');
        const loginForm = document.getElementById('login-form');
        const userTypeSelect = document.getElementById('user-type');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const studentLogoutBtn = document.getElementById('student-logout');
        const adminLogoutBtn = document.getElementById('admin-logout');
        const studentWelcome = document.getElementById('student-welcome');
        const studentInfo = document.getElementById('student-info');
        const examsBtn = document.getElementById('exams-btn');
        const lessonsBtn = document.getElementById('lessons-btn');
        const examsSection = document.getElementById('exams-section');
        const lessonsSection = document.getElementById('lessons-section');
        const backFromExamsBtn = document.getElementById('back-from-exams');
        const backFromLessonsBtn = document.getElementById('back-from-lessons');
        const examsList = document.getElementById('exams-list');
        const lessonsList = document.getElementById('lessons-list');
        const examsTitle = document.getElementById('exams-title');
        const lessonsTitle = document.getElementById('lessons-title');
        const manageLessonsBtn = document.getElementById('manage-lessons');
        const manageExamsBtn = document.getElementById('manage-exams');
        const lessonsManagement = document.getElementById('lessons-management');
        const examsManagement = document.getElementById('exams-management');
        const addLessonForm = document.getElementById('add-lesson-form');
        const addExamForm = document.getElementById('add-exam-form');
        const lessonsTableBody = document.getElementById('lessons-table-body');
        const examsTableBody = document.getElementById('exams-table-body');
        const loading = document.getElementById('loading');

        // المتغيرات الحالية
        let currentUser = null;
        let currentUserType = null;

        // أيام الأسبوع
        const daysOfWeek = [
            { id: 'sunday', name: 'الأحد' },
            { id: 'monday', name: 'الاثنين' },
            { id: 'tuesday', name: 'الثلاثاء' },
            { id: 'wednesday', name: 'الأربعاء' },
            { id: 'thursday', name: 'الخميس' }
        ];

        // تهيئة التطبيق
        function initApp() {
            setupEventListeners();
            checkExistingLogin();
        }

        // إعداد مستمعي الأحداث
        function setupEventListeners() {
            // تسجيل الدخول
            loginForm.addEventListener('submit', handleLogin);
            
            // تسجيل الخروج
            studentLogoutBtn.addEventListener('click', handleLogout);
            adminLogoutBtn.addEventListener('click', handleLogout);
            
            // التنقل في واجهة الطالب
            examsBtn.addEventListener('click', showExams);
            lessonsBtn.addEventListener('click', showLessons);
            backFromExamsBtn.addEventListener('click', () => hideSection(examsSection));
            backFromLessonsBtn.addEventListener('click', () => hideSection(lessonsSection));
            
            // التنقل في واجهة الإدارة
            manageLessonsBtn.addEventListener('click', () => showManagementSection(lessonsManagement, examsManagement));
            manageExamsBtn.addEventListener('click', () => showManagementSection(examsManagement, lessonsManagement));
            
            // إضافة بيانات جديدة
            addLessonForm.addEventListener('submit', addLesson);
            addExamForm.addEventListener('submit', addExam);
        }

        // التحقق من وجود تسجيل دخول سابق
        function checkExistingLogin() {
            const savedUser = localStorage.getItem('currentUser');
            const savedUserType = localStorage.getItem('currentUserType');
            
            if (savedUser && savedUserType) {
                currentUser = JSON.parse(savedUser);
                currentUserType = savedUserType;
                showDashboard();
            }
        }

        // معالجة تسجيل الدخول
        function handleLogin(e) {
            e.preventDefault();
            
            const userType = userTypeSelect.value;
            const username = usernameInput.value;
            const password = passwordInput.value;
            
            if (!userType || !username || !password) {
                alert('يرجى ملء جميع الحقول');
                return;
            }
            
            // التحقق من بيانات المستخدم (في بيئة حقيقية، يجب التحقق من الخادم)
            if (userType === 'student') {
                if (username === users.student.username && password === users.student.password) {
                    currentUser = users.student;
                    currentUserType = 'student';
                } else {
                    alert('بيانات الدخول غير صحيحة للطالب');
                    return;
                }
            } else if (userType === 'admin') {
                if (username === users.admin.username && password === users.admin.password) {
                    currentUser = users.admin;
                    currentUserType = 'admin';
                } else {
                    alert('بيانات الدخول غير صحيحة للإدارة');
                    return;
                }
            }
            
            // حفظ حالة تسجيل الدخول
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('currentUserType', currentUserType);
            
            showDashboard();
        }

        // معالجة تسجيل الخروج
        function handleLogout() {
            currentUser = null;
            currentUserType = null;
            localStorage.removeItem('currentUser');
            localStorage.removeItem('currentUserType');
            
            loginSection.classList.remove('hidden');
            studentDashboard.classList.add('hidden');
            adminDashboard.classList.add('hidden');
            examsSection.classList.add('hidden');
            lessonsSection.classList.add('hidden');
            
            // إعادة تعيين نموذج تسجيل الدخول
            loginForm.reset();
        }

        // عرض لوحة التحكم المناسبة
        function showDashboard() {
            loginSection.classList.add('hidden');
            
            if (currentUserType === 'student') {
                studentDashboard.classList.remove('hidden');
                adminDashboard.classList.add('hidden');
                
                // تحديث معلومات الطالب
                studentWelcome.textContent = `مرحباً، ${currentUser.username}`;
                studentInfo.textContent = `${currentUser.grade} - ${currentUser.class}`;
            } else if (currentUserType === 'admin') {
                studentDashboard.classList.add('hidden');
                adminDashboard.classList.remove('hidden');
                
                // تحميل بيانات الإدارة
                loadAdminData();
            }
        }

        // تحميل بيانات الإدارة
        function loadAdminData() {
            loadLessonsTable();
            loadExamsTable();
        }

        // عرض جدول الامتحانات للطالب
        function showExams() {
            showLoading(true);
            
            // جلب البيانات من Firebase
            database.ref('exams').once('value')
                .then(snapshot => {
                    showLoading(false);
                    const exams = snapshot.val();
                    renderExamsList(exams);
                    examsTitle.textContent = `جدول الامتحانات - ${currentUser.grade} ${currentUser.class}`;
                    examsSection.classList.remove('hidden');
                })
                .catch(error => {
                    showLoading(false);
                    console.error('Error fetching exams:', error);
                    renderExamsList(null, true);
                    examsSection.classList.remove('hidden');
                });
        }

        // عرض جدول الدروس للطالب
        function showLessons() {
            showLoading(true);
            
            // جلب البيانات من Firebase
            database.ref('lessons').once('value')
                .then(snapshot => {
                    showLoading(false);
                    const lessons = snapshot.val();
                    renderLessonsList(lessons);
                    lessonsTitle.textContent = `جدول الدروس - ${currentUser.grade} ${currentUser.class}`;
                    lessonsSection.classList.remove('hidden');
                })
                .catch(error => {
                    showLoading(false);
                    console.error('Error fetching lessons:', error);
                    renderLessonsList(null, true);
                    lessonsSection.classList.remove('hidden');
                });
        }

        // عرض قائمة الامتحانات
        function renderExamsList(exams, isError = false) {
            examsList.innerHTML = '';
            
            if (isError) {
                examsList.innerHTML = `
                    <li class="data-item">
                        <h3>خطأ في تحميل البيانات</h3>
                        <p>تعذر تحميل جدول الامتحانات. يرجى المحاولة مرة أخرى.</p>
                    </li>
                `;
                return;
            }
            
            if (!exams) {
                examsList.innerHTML = `
                    <li class="data-item">
                        <h3>لا توجد امتحانات</h3>
                        <p>لا توجد امتحانات مسجلة حالياً.</p>
                    </li>
                `;
                return;
            }
            
            // تصفية الامتحانات الخاصة بالطالب الحالي
            const studentGrade = getGradeId(currentUser.grade);
            const studentClass = currentUser.class;
            const filteredExams = Object.entries(exams)
                .map(([id, exam]) => ({ id, ...exam }))
                .filter(exam => exam.grade === studentGrade && exam.class === studentClass);
            
            if (filteredExams.length === 0) {
                examsList.innerHTML = `
                    <li class="data-item">
                        <h3>لا توجد امتحانات</h3>
                        <p>لا توجد امتحانات مسجلة للصف والشعبة الحالية.</p>
                    </li>
                `;
                return;
            }
            
            // عرض كل امتحان
            filteredExams.forEach((exam, index) => {
                const examItem = document.createElement('li');
                examItem.className = 'data-item';
                examItem.style.animationDelay = `${index * 0.1}s`;
                
                examItem.innerHTML = `
                    <h3>${exam.subject || 'بدون عنوان'}</h3>
                    <p><strong>التاريخ:</strong> ${exam.date || 'غير محدد'}</p>
                    <p><strong>الوقت:</strong> ${exam.time || 'غير محدد'}</p>
                    <p><strong>المدة:</strong> ${exam.duration || 'غير محدد'}</p>
                `;
                
                examsList.appendChild(examItem);
            });
        }

        // عرض قائمة الدروس
        function renderLessonsList(lessons, isError = false) {
            lessonsList.innerHTML = '';
            
            if (isError) {
                lessonsList.innerHTML = `
                    <div class="data-item">
                        <h3>خطأ في تحميل البيانات</h3>
                        <p>تعذر تحميل جدول الدروس. يرجى المحاولة مرة أخرى.</p>
                    </div>
                `;
                return;
            }
            
            if (!lessons) {
                lessonsList.innerHTML = `
                    <div class="data-item">
                        <h3>لا توجد دروس</h3>
                        <p>لا توجد دروس مسجلة حالياً.</p>
                    </div>
                `;
                return;
            }
            
            // تصفية الدروس الخاصة بالطالب الحالي
            const studentGrade = getGradeId(currentUser.grade);
            const studentClass = currentUser.class;
            const filteredLessons = Object.entries(lessons)
                .map(([id, lesson]) => ({ id, ...lesson }))
                .filter(lesson => lesson.grade === studentGrade && lesson.class === studentClass);
            
            if (filteredLessons.length === 0) {
                lessonsList.innerHTML = `
                    <div class="data-item">
                        <h3>لا توجد دروس</h3>
                        <p>لا توجد دروس مسجلة للصف والشعبة الحالية.</p>
                    </div>
                `;
                return;
            }
            
            // تجميع الدروس حسب اليوم
            daysOfWeek.forEach(day => {
                const dayLessons = filteredLessons.filter(lesson => lesson.day === day.id);
                
                if (dayLessons.length > 0) {
                    const dayGroup = document.createElement('div');
                    dayGroup.className = 'day-group';
                    
                    dayGroup.innerHTML = `<h3>${day.name}</h3>`;
                    
                    dayLessons.forEach(lesson => {
                        const lessonItem = document.createElement('div');
                        lessonItem.className = 'data-item';
                        
                        lessonItem.innerHTML = `
                            <h4>${lesson.subject || 'بدون عنوان'}</h4>
                            <p><strong>الوقت:</strong> ${lesson.time || 'غير محدد'}</p>
                            <p><strong>المعلم:</strong> ${lesson.teacher || 'غير محدد'}</p>
                        `;
                        
                        dayGroup.appendChild(lessonItem);
                    });
                    
                    lessonsList.appendChild(dayGroup);
                }
            });
        }

        // إخفاء قسم
        function hideSection(section) {
            section.classList.add('hidden');
        }

        // عرض قسم إدارة مع إخفاء الأقسام الأخرى
        function showManagementSection(showSection, hideSection) {
            showSection.classList.remove('hidden');
            hideSection.classList.add('hidden');
        }

        // إضافة درس جديد
        function addLesson(e) {
            e.preventDefault();
            
            const grade = document.getElementById('lesson-grade').value;
            const classValue = document.getElementById('lesson-class').value;
            const day = document.getElementById('lesson-day').value;
            const time = document.getElementById('lesson-time').value;
            const subject = document.getElementById('lesson-subject').value;
            const teacher = document.getElementById('lesson-teacher').value;
            
            if (!grade || !classValue || !day || !time || !subject || !teacher) {
                alert('يرجى ملء جميع الحقول');
                return;
            }
            
            const newLesson = {
                grade,
                class: classValue,
                day,
                time,
                subject,
                teacher,
                createdAt: new Date().toISOString()
            };
            
            // إضافة إلى Firebase
            database.ref('lessons').push(newLesson)
                .then(() => {
                    alert('تم إضافة الدرس بنجاح');
                    addLessonForm.reset();
                    loadLessonsTable();
                })
                .catch(error => {
                    console.error('Error adding lesson:', error);
                    alert('حدث خطأ أثناء إضافة الدرس');
                });
        }

        // إضافة امتحان جديد
        function addExam(e) {
            e.preventDefault();
            
            const grade = document.getElementById('exam-grade').value;
            const classValue = document.getElementById('exam-class').value;
            const date = document.getElementById('exam-date').value;
            const time = document.getElementById('exam-time').value;
            const subject = document.getElementById('exam-subject').value;
            const duration = document.getElementById('exam-duration').value;
            
            if (!grade || !classValue || !date || !time || !subject || !duration) {
                alert('يرجى ملء جميع الحقول');
                return;
            }
            
            const newExam = {
                grade,
                class: classValue,
                date,
                time,
                subject,
                duration,
                createdAt: new Date().toISOString()
            };
            
            // إضافة إلى Firebase
            database.ref('exams').push(newExam)
                .then(() => {
                    alert('تم إضافة الامتحان بنجاح');
                    addExamForm.reset();
                    loadExamsTable();
                })
                .catch(error => {
                    console.error('Error adding exam:', error);
                    alert('حدث خطأ أثناء إضافة الامتحان');
                });
        }

        // تحميل جدول الدروس للإدارة
        function loadLessonsTable() {
            database.ref('lessons').once('value')
                .then(snapshot => {
                    const lessons = snapshot.val();
                    renderLessonsTable(lessons);
                })
                .catch(error => {
                    console.error('Error loading lessons:', error);
                    renderLessonsTable(null, true);
                });
        }

        // تحميل جدول الامتحانات للإدارة
        function loadExamsTable() {
            database.ref('exams').once('value')
                .then(snapshot => {
                    const exams = snapshot.val();
                    renderExamsTable(exams);
                })
                .catch(error => {
                    console.error('Error loading exams:', error);
                    renderExamsTable(null, true);
                });
        }

        // عرض جدول الدروس للإدارة
        function renderLessonsTable(lessons, isError = false) {
            lessonsTableBody.innerHTML = '';
            
            if (isError) {
                lessonsTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">خطأ في تحميل البيانات</td>
                    </tr>
                `;
                return;
            }
            
            if (!lessons) {
                lessonsTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">لا توجد دروس مسجلة</td>
                    </tr>
                `;
                return;
            }
            
            // تحويل كائن الدروس إلى مصفوفة
            const lessonsArray = Object.entries(lessons).map(([id, lesson]) => ({
                id,
                ...lesson
            }));
            
            // عرض كل درس في الجدول
            lessonsArray.forEach(lesson => {
                const row = document.createElement('tr');
                
                const gradeNames = {
                    'grade4': 'الصف الرابع علمي',
                    'grade5': 'الصف الخامس علمي',
                    'grade6': 'الصف السادس علمي'
                };
                
                const dayNames = {
                    'sunday': 'الأحد',
                    'monday': 'الاثنين',
                    'tuesday': 'الثلاثاء',
                    'wednesday': 'الأربعاء',
                    'thursday': 'الخميس'
                };
                
                row.innerHTML = `
                    <td>${gradeNames[lesson.grade] || lesson.grade}</td>
                    <td>${lesson.class}</td>
                    <td>${dayNames[lesson.day] || lesson.day}</td>
                    <td>${lesson.time}</td>
                    <td>${lesson.subject}</td>
                    <td>${lesson.teacher}</td>
                    <td class="action-buttons">
                        <button class="btn btn-secondary" onclick="editLesson('${lesson.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger" onclick="deleteLesson('${lesson.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                lessonsTableBody.appendChild(row);
            });
        }

        // عرض جدول الامتحانات للإدارة
        function renderExamsTable(exams, isError = false) {
            examsTableBody.innerHTML = '';
            
            if (isError) {
                examsTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">خطأ في تحميل البيانات</td>
                    </tr>
                `;
                return;
            }
            
            if (!exams) {
                examsTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">لا توجد امتحانات مسجلة</td>
                    </tr>
                `;
                return;
            }
            
            // تحويل كائن الامتحانات إلى مصفوفة
            const examsArray = Object.entries(exams).map(([id, exam]) => ({
                id,
                ...exam
            }));
            
            // عرض كل امتحان في الجدول
            examsArray.forEach(exam => {
                const row = document.createElement('tr');
                
                const gradeNames = {
                    'grade4': 'الصف الرابع علمي',
                    'grade5': 'الصف الخامس علمي',
                    'grade6': 'الصف السادس علمي'
                };
                
                row.innerHTML = `
                    <td>${gradeNames[exam.grade] || exam.grade}</td>
                    <td>${exam.class}</td>
                    <td>${exam.date}</td>
                    <td>${exam.time}</td>
                    <td>${exam.subject}</td>
                    <td>${exam.duration}</td>
                    <td class="action-buttons">
                        <button class="btn btn-secondary" onclick="editExam('${exam.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger" onclick="deleteExam('${exam.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                examsTableBody.appendChild(row);
            });
        }

        // حذف درس
        function deleteLesson(lessonId) {
            if (confirm('هل أنت متأكد من حذف هذا الدرس؟')) {
                database.ref(`lessons/${lessonId}`).remove()
                    .then(() => {
                        alert('تم حذف الدرس بنجاح');
                        loadLessonsTable();
                    })
                    .catch(error => {
                        console.error('Error deleting lesson:', error);
                        alert('حدث خطأ أثناء حذف الدرس');
                    });
            }
        }

        // حذف امتحان
        function deleteExam(examId) {
            if (confirm('هل أنت متأكد من حذف هذا الامتحان؟')) {
                database.ref(`exams/${examId}`).remove()
                    .then(() => {
                        alert('تم حذف الامتحان بنجاح');
                        loadExamsTable();
                    })
                    .catch(error => {
                        console.error('Error deleting exam:', error);
                        alert('حدث خطأ أثناء حذف الامتحان');
                    });
            }
        }

        // الحصول على معرف الصف
        function getGradeId(gradeName) {
            const gradeMap = {
                'الصف الرابع علمي': 'grade4',
                'الصف الخامس علمي': 'grade5',
                'الصف السادس علمي': 'grade6'
            };
            return gradeMap[gradeName] || gradeName;
        }

        // تعديل درس (وظيفة تجريبية)
        function editLesson(lessonId) {
            alert('وظيفة التعديل قيد التطوير. معرف الدرس: ' + lessonId);
        }

        // تعديل امتحان (وظيفة تجريبية)
        function editExam(examId) {
            alert('وظيفة التعديل قيد التطوير. معرف الامتحان: ' + examId);
        }

        // عرض/إخفاء مؤشر التحميل
        function showLoading(show) {
            if (show) {
                loading.classList.remove('hidden');
            } else {
                loading.classList.add('hidden');
            }
        }

        // بدء التطبيق عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
